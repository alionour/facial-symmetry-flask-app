<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/results.css">
</head>
<body>

<!-- Dedicated Results Page -->

<div id="resultsContainer" class="results-container">
  <!-- Loading State -->
  <div id="resultsLoading" class="results-loading" style="display: block;">
    <div class="results-card">
      <div class="spinner"></div>
      <h3 style="color: #2c3e50; margin: 0 0 10px 0;">{{ _('Loading Results...') }}</h3>
      <p style="color: #7f8c8d; margin: 0;">{{ _('Please wait while we prepare your facial symmetry analysis.') }}</p>
      <div id="mobileDebugInfo" style="
        margin-top: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
        font-size: 12px;
        color: #6c757d;
        display: none;
      ">
        <strong>{{ _('Debug Info:') }}</strong><br>
        <span id="debugUserAgent"></span><br>
        <span id="debugTimestamp"></span>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div id="resultsError" class="results-error" style="display: none;">
    <div class="results-card error-card">
      <h3 style="color: #e74c3c; margin: 0 0 15px 0;">
        <i class="fas fa-exclamation-triangle" style="margin-right: 10px;"></i>
        {{ _('No Results Found') }}
      </h3>
      <p style="color: #7f8c8d; margin: 0 0 20px 0; line-height: 1.6;">
        {{ _('We couldn\'t find any examination results to display. This might happen if:') }}
      </p>
      <ul class="error-list">
        <li>{{ _('You navigated directly to this page without completing an examination') }}</li>
        <li>{{ _('Your examination data has expired or been cleared') }}</li>
        <li>{{ _('There was an error during the examination process') }}</li>
      </ul>
      <div class="error-actions">
        <button id="startNewExam" class="results-btn primary" onclick="window.location.hash = ''">
          {{ _('Start New Examination') }}
        </button>
        <button id="goHome" class="results-btn secondary" onclick="window.location.hash = ''">
          {{ _('Go to Home') }}
        </button>
      </div>
    </div>
  </div>

  <!-- Results Content (will be populated by ResultsController) -->
  <div id="resultsContent" style="display: none;">
    <!-- Results will be dynamically inserted here -->
</div>

<!-- EXPLANATION SECTION -->
<div class="results-card explanation-section">
  <h2>{{ _('How Are These Results Calculated?') }}</h2>
  <h3>{{ _('Eyebrow Elevation') }}</h3>
  <p>
    {{ _('For each eyebrow, several key points are tracked. The system measures how much each point moves upward when you raise your eyebrows, compared to their position at rest.') }}<br>
    <strong>{{ _('How is the movement measured?') }}</strong>
    <ul>
      <li>{{ _('The <b>vertical displacement</b> (how much the point moved up) is measured.') }}</li>
      <li>{{ _('The <b>horizontal distance</b> from the eyebrow point to the center of the eye is also measured.') }}</li>
      <li>{{ _('The <b>angle of elevation</b> is calculated using the arctangent of (vertical/horizontal), giving a value in degrees for each point.') }}</li>
      <li>{{ _('These angles are averaged for each eyebrow to get the final elevation score.') }}</li>
    </ul>
    <em>{{ _('This method is robust to face size and head tilt, and gives a normalized measure of eyebrow movement.') }}</em>
    <br><br>
    <b>{{ _('Visualization:') }}</b><br>
    <svg width="260" height="120" style="margin-top:8px;">
      <line x1="40" y1="100" x2="200" y2="100" stroke="#bbb" stroke-width="2" />
      <circle cx="40" cy="100" r="6" fill="#3498db" />
      <text x="20" y="115" font-size="12" fill="#3498db">{{ _('Eye') }}</text>
      <circle cx="200" cy="100" r="6" fill="#2ecc71" />
      <text x="180" y="115" font-size="12" fill="#2ecc71">{{ _('Baseline') }}</text>
      <circle cx="200" cy="40" r="6" fill="#e67e22" />
      <text x="200" y="30" font-size="12" fill="#e67e22">{{ _('Raised') }}</text>
      <line x1="200" y1="100" x2="200" y2="40" stroke="#e67e22" stroke-width="2" stroke-dasharray="4" />
      <line x1="40" y1="100" x2="200" y2="40" stroke="#9b59b6" stroke-width="2" />
      <path d="M60 100 A20 20 0 0 1 200 80" fill="none" stroke="#c0392b" stroke-width="2" />
      <text x="110" y="90" font-size="13" fill="#c0392b">{{ _('Œ∏ (angle)') }}</text>
    </svg>
  </p>
  <h3>{{ _('Eye Closure') }}</h3>
  <p>
    {{ _('Eye closure is measured by tracking the distance between the upper and lower eyelid landmarks for each eye.') }}
    <ul>
      <li>{{ _('At rest and during closure, the vertical distances between eyelid points are measured.') }}</li>
      <li>{{ _('The <b>percentage of closure</b> is calculated as the reduction in this distance from open to closed.') }}</li>
      <li>{{ _('Higher percentages mean the eye is more fully closed.') }}</li>
    </ul>
    <em>{{ _('This method helps detect incomplete closure (lagophthalmos).') }}</em>
    <br><br>
    <b>{{ _('Visualization:') }}</b><br>
    <svg width="220" height="80" style="margin-top:8px;">
      <!-- Eye outline -->
      <ellipse cx="110" cy="40" rx="80" ry="28" fill="#f8f9fa" stroke="#bbb" stroke-width="2" />
      <!-- Upper eyelid (open) -->
      <path d="M30 40 Q110 10 190 40" stroke="#3498db" stroke-width="3" fill="none" />
      <!-- Lower eyelid (open) -->
      <path d="M30 40 Q110 70 190 40" stroke="#3498db" stroke-width="3" fill="none" />
      <!-- Closed eyelid -->
      <line x1="30" y1="40" x2="190" y2="40" stroke="#e67e22" stroke-width="3" stroke-dasharray="5,3" />
      <text x="40" y="20" font-size="12" fill="#3498db">{{ _('Open') }}</text>
      <text x="140" y="35" font-size="12" fill="#e67e22">{{ _('Closed') }}</text>
      <text x="100" y="78" font-size="13" fill="#c0392b">{{ _('Vertical distance') }}</text>
      <line x1="110" y1="22" x2="110" y2="58" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow)" marker-start="url(#arrow)" />
      <defs>
        <marker id="arrow" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 L2,3 z" fill="#c0392b" />
        </marker>
      </defs>
    </svg>
  </p>
  <h3>{{ _('Smile (Mouth Movement)') }}</h3>
  <p>
    {{ _('Smile analysis focuses on the movement of the mouth corners using robust, clinically meaningful reference lines.') }}<br>
    <strong>{{ _('How is the movement measured?') }}</strong>
    <ul>
      <li><b>{{ _('Corner Movement (mm):') }}</b> {{ _('For each mouth corner, the Euclidean distance (in millimeters) from its baseline (rest) position to its peak smile position is calculated. This is normalized using the interpupillary distance for scale invariance.') }}</li>
      <li><b>{{ _('Horizontal Distance (mm):') }}</b> {{ _('The horizontal distance from each mouth corner to the <b>tilted horizontal reference line</b> (drawn through the chin tip, parallel to the line between the inner eye midpoint and chin tip) is measured. This quantifies how far each corner moves sideways during a smile.') }}</li>
      <li><b>{{ _('Vertical Distance (mm):') }}</b> {{ _('The vertical distance from each mouth corner to the <b>vertical reference line</b> (from the inner eye midpoint down through the chin tip) is measured. This quantifies how far each corner moves upward during a smile.') }}</li>

    </ul>
    <em>{{ _('This approach quantifies both the strength and symmetry of your smile, using anatomical reference lines for clinical accuracy.') }}</em>
    <br><br>
    <b>{{ _('Visualization:') }}</b><br>
    <svg width="340" height="190" style="margin-top:8px;">
      <!-- Face outline (simplified) -->
      <ellipse cx="170" cy="110" rx="90" ry="55" fill="#f8f9fa" stroke="#bbb" stroke-width="2" />
      <!-- Eyes -->
      <ellipse cx="110" cy="80" rx="18" ry="7" fill="#eaf6fb" stroke="#bbb" stroke-width="1.5" />
      <ellipse cx="230" cy="80" rx="18" ry="7" fill="#eaf6fb" stroke="#bbb" stroke-width="1.5" />
      <!-- Chin tip -->
      <circle cx="170" cy="155" r="5" fill="#e67e22" />
      <text x="178" y="160" font-size="11" fill="#e67e22">{{ _('Chin Tip') }}</text>
      <!-- Inner eye midpoint -->
      <circle cx="170" cy="80" r="5" fill="#2980b9" />
      <text x="178" y="85" font-size="11" fill="#2980b9">{{ _('Eye Midpoint') }}</text>
      <!-- Vertical reference line -->
      <line x1="170" y1="80" x2="170" y2="155" stroke="#9b59b6" stroke-width="2" stroke-dasharray="4" />
      <text x="175" y="120" font-size="11" fill="#9b59b6">{{ _('Vertical Ref.') }}</text>
      <!-- Tilted horizontal reference line -->
      <line x1="100" y1="155" x2="240" y2="155" stroke="#27ae60" stroke-width="2" stroke-dasharray="4" />
      <text x="245" y="158" font-size="11" fill="#27ae60">{{ _('Horizontal Ref.') }}</text>
      <!-- Mouth at rest -->
      <circle cx="130" cy="140" r="5" fill="#3498db" />
      <circle cx="210" cy="140" r="5" fill="#3498db" />
      <text x="70" y="152" font-size="12" fill="#3498db">{{ _('Left corner (rest)') }}</text>
      <text x="215" y="152" font-size="12" fill="#3498db">{{ _('Right corner (rest)') }}</text>
      <!-- Mouth during smile -->
      <circle cx="130" cy="120" r="5" fill="#e67e22" />
      <circle cx="210" cy="119" r="5" fill="#e67e22" />
      <text x="60" y="115" font-size="12" fill="#e67e22">{{ _('Left (smile)') }}</text>
      <text x="220" y="115" font-size="12" fill="#e67e22">{{ _('Right (smile)') }}</text>
      <!-- Movement arrows (vertical) -->
      <line x1="130" y1="140" x2="130" y2="120" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow2)" />
      <line x1="210" y1="140" x2="210" y2="119" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow2)" />
      <!-- Movement arrows (horizontal, to vertical ref) -->
      <line x1="130" y1="120" x2="170" y2="120" stroke="#8e44ad" stroke-width="2" marker-end="url(#arrow3)" />
      <line x1="210" y1="119" x2="170" y2="119" stroke="#8e44ad" stroke-width="2" marker-end="url(#arrow3)" />
      <text x="135" y="112" font-size="11" fill="#8e44ad">{{ _('Horizontal') }}</text>
      <text x="175" y="112" font-size="11" fill="#8e44ad">{{ _('Horizontal') }}</text>
      <!-- Movement arrows (vertical, to horizontal ref) -->
      <line x1="130" y1="120" x2="130" y2="155" stroke="#16a085" stroke-width="2" marker-end="url(#arrow4)" />
      <line x1="210" y1="119" x2="210" y2="155" stroke="#16a085" stroke-width="2" marker-end="url(#arrow4)" />
      <text x="100" y="170" font-size="11" fill="#16a085">{{ _('Vertical') }}</text>
      <text x="220" y="170" font-size="11" fill="#16a085">{{ _('Vertical') }}</text>
      <!-- Example values -->
      <text x="10" y="30" font-size="13" fill="#c0392b">{{ _('Left Corner Movement: 4.98mm') }}</text>
      <text x="180" y="30" font-size="13" fill="#c0392b">{{ _('Right Corner Movement: 5.01mm') }}</text>
      <text x="10" y="50" font-size="12" fill="#8e44ad">üìè {{ _('Left Horizontal: 15.30mm') }}</text>
      <text x="180" y="50" font-size="12" fill="#8e44ad">{{ _('Right Horizontal: 15.63mm') }}</text>
      <text x="10" y="70" font-size="12" fill="#16a085">üìê {{ _('Left Vertical: 38.51mm') }}</text>
      <text x="180" y="70" font-size="12" fill="#16a085">{{ _('Right Vertical: 36.28mm') }}</text>
      <defs>
        <marker id="arrow2" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 L2,3 z" fill="#c0392b" />
        </marker>
        <marker id="arrow3" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 L2,3 z" fill="#8e44ad" />
        </marker>
        <marker id="arrow4" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 L2,3 z" fill="#16a085" />
        </marker>
      </defs>
    </svg>
  </p>
</div>
  </div>

  <!-- Footer with Version Information -->
  <footer class="results-footer">
    <div class="footer-content">
      <p class="version-info">
        {{ _('Loading version information...') }}
      </p>
    </div>
    <script type="module">
      import { VersionManager } from '../../../core/version/VersionManager.js';

      document.addEventListener('DOMContentLoaded', () => {
        const versionInfoElement = document.querySelector('.version-info');
        const currentVersion = VersionManager.getVersionString();
        versionInfoElement.textContent = `Facial Symmetry Analysis ${currentVersion} | Released: ${VersionManager.getCurrentVersion().releaseDate}`;
      });
    </script>
  </footer>
</div>

<script>
// Mobile-specific results page debugging
(function() {
  console.log('Results page loaded, checking mobile compatibility...');

  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  console.log('Is mobile device:', isMobile);

  if (isMobile) {
    // Show debug info on mobile
    const debugInfo = document.getElementById('mobileDebugInfo');
    const userAgentSpan = document.getElementById('debugUserAgent');
    const timestampSpan = document.getElementById('debugTimestamp');

    if (debugInfo && userAgentSpan && timestampSpan) {
      userAgentSpan.textContent = `User Agent: ${navigator.userAgent.substring(0, 50)}...`;
      timestampSpan.textContent = `Loaded at: ${new Date().toLocaleTimeString()}`;
      debugInfo.style.display = 'block';
    }

    // Add mobile-specific error handling
    window.addEventListener('error', (e) => {
      console.error('Mobile results page error:', e);
    });

    // Check for localStorage availability
    try {
      const testKey = 'mobile_test';
      localStorage.setItem(testKey, 'test');
      localStorage.removeItem(testKey);
      console.log('localStorage is available on mobile');
    } catch (e) {
      console.error('localStorage not available on mobile:', e);
    }
  }

  // Enhanced results container detection
  const container = document.getElementById('resultsContainer');
  if (container) {
    console.log('Results container found successfully');
    container.setAttribute('data-mobile-ready', 'true');
  } else {
    console.error('Results container not found!');
  }
})();
</script>

</body>
</html>
