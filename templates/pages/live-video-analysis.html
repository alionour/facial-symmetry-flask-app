<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../static/main.css">
  <link rel="stylesheet" href="../static/live-video-analysis.css">
</head>
<body>

<div id="liveVideoAnalysisView" class="live-video-analysis-container">
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <div class="brand-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span class="brand-text">{{ _('Live Video Analysis') }}</span>
      </div>
      <div class="nav-actions">
        <button class="nav-btn" onclick="goBackToHome()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" fill="currentColor"/>
          </svg>
          {{ _('Back to Home') }}
        </button>
        <button id="nextBtn" class="nav-btn primary" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
          </svg>
          {{ _('Next Action') }}
        </button>
        <button id="finishBtn" class="nav-btn success" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
          </svg>
          {{ _('Finish Analysis') }}
        </button>
      </div>
    </div>
  </nav>

  <!-- Action Title Section -->
  <div class="action-title-section">
    <h2 id="actionTitle" class="action-title">{{ _('Ready to Begin Assessment') }}</h2>
  </div>

  <!-- Camera Views Section -->
  <div class="camera-section">
    <div class="camera-views">
      <!-- Live Camera Feed -->
      <div class="camera-view live">
        <div class="camera-header live">{{ _('Live Camera') }}</div>
        <div class="camera-content">
          <video id="video" autoplay muted playsinline style="display: block; background: #333;"></video>
          <canvas id="canvas"></canvas>
        </div>
      </div>

      <!-- Analysis View -->
      <div class="camera-view analysis">
        <div class="camera-header analysis">{{ _('Analysis View') }}</div>
        <div class="camera-content">
          <canvas id="analysisCanvas" style="display: block; background: #222;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Switch Camera Button (Mobile Only) -->
  <div id="switchCameraSection" class="camera-switch-section" style="display: none;">
    <button id="switchCameraBtn" class="live-video-analysis-btn teal" title="{{ _('Switch between front and back cameras') }}">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 4H16.83L15 2H9L7.17 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7S17 9.24 17 12S14.76 17 12 17Z" fill="currentColor"/>
      </svg>
      {{ _('Switch Camera') }}
    </button>
  </div>



  <!-- Mobile Camera Positioning Instructions -->
  <div id="mobileInstructions" class="mobile-instructions" style="display: none;">
    <div class="mobile-instruction-card">
      <h4>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21C5,22.11 5.89,23 7,23H17C18.11,23 19,22.11 19,21V3C19,1.89 18.11,1 17,1Z" fill="currentColor"/>
        </svg>
        {{ _('Mobile Camera Setup') }}
      </h4>
      <ul>
        <li>{{ _('Hold device at arm\'s length (about 18-24 inches away)') }}</li>
        <li>{{ _('Ensure your entire face is visible in the camera view') }}</li>
        <li>{{ _('Include forehead, chin, and both ears if possible') }}</li>
        <li>{{ _('Use good lighting - face the light source') }}</li>
        <li>{{ _('Keep device steady during analysis') }}</li>
      </ul>
    </div>
  </div>

  <!-- Live Video Analysis Interface -->
  <div id="liveVideoAnalysisInterface" style="display: none; text-align: center; margin: 20px auto; max-width: 600px;"></div>
</div>

<script>
// Navigation function
function goBackToHome() {
  window.location.href = '/';
}

// Show mobile instructions on mobile devices
(function() {
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  console.log('Mobile device detected in live video analysis view:', isMobile);

  if (isMobile) {
    const mobileInstructions = document.getElementById('mobileInstructions');
    if (mobileInstructions) {
      mobileInstructions.style.display = 'block';
      console.log('Mobile camera instructions displayed');
    }
  }
})();
</script>

</body>
</html>
